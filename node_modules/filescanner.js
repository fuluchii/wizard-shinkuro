var fs = require('fs')
var fsstat = require('fsstat')
var config = require('config')
var path = require('path')

function FileScanner(){
	this.config = new config.Config()
	this.filelist = []
}

FileScanner.prototype.scan_dir = function (dirpath){
	var self = this
	var config = this.config
	var stat = fsstat.stat(dirpath)
	var filelist = this.filelist
	if (stat.type === 'dir'){
		var files = fs.readdirSync(dirpath)
		for (var i = 0; i < files.length; ++i) {
			var type = fsstat.stat(path.join(dirpath, files[i])).type
			var state = config.file_modify_stat(path.join(dirpath, files[i]))
			if(type && type !=='dir' && state){
				var file = {"path":path.join(dirpath, files[i]),"state":state}
				filelist.push(file)
      		}else if (type == 'dir'){
      			this.scan_dir(path.join(dirpath, files[i]))
      		}
    	}
	}
}

FileScanner.prototype.clear = function(){
	this.filelist = []
}

exports.FileScanner = FileScanner



// scanner = new FileScanner('/Users/fuluchii/Documents/node/node-webkit-v0.7.5-osx-ia32')
// scanner.scanDir('/Users/fuluchii/Documents/work/git/shop/shop-web/src')
// console.log(scanner.filelist)