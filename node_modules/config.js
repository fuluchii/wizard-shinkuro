var fs = require('fs')
var fsstat = require("fsstat")

function ConfigReader(){
	this.new_config = JSON.parse(fs.readFileSync("config.json",'utf-8'))
	this.config = JSON.parse(fs.readFileSync("config.json",'utf-8'))
}

ConfigReader.prototype.sync_file = function (filename){
	var files = this.new_config.files
	files[filename] = (new Date()).getTime()
}

ConfigReader.prototype.update_config = function(){
	this.config = JSON.parse(JSON.stringify(this.new_config))
	fs.writeFile("config.json",JSON.stringify(this.new_config),function  (err) {
		if(err){
			console.log(err)
		}
	})
}

ConfigReader.prototype.file_modify_stat = function(filename){
	var files = this.config.files
	var file_stat = fsstat.stat(filename)
	if(files[filename]){
		if(file_stat.type){
			if(files[filename]<file_stat.mtime){

				return 'modified'
			}else{
				return 'no change'
			}
		}
	}else if(file_stat.type){
		return 'new'
	}
	return undefined
}

exports.Config = ConfigReader
